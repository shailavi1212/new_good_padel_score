<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PADEL LIVE — Admin Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg-deep: #050810;
  --bg-primary: #0b0f1a;
  --bg-secondary: #111827;
  --bg-card: rgba(15, 20, 35, 0.9);
  --bg-input: rgba(10, 14, 26, 0.8);

  --neon-cyan: #00f0ff;
  --neon-purple: #a855f7;
  --neon-pink: #f472b6;
  --neon-green: #22d3ee;
  --neon-yellow: #fbbf24;
  --neon-red: #ef4444;

  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-bright: #ffffff;

  --radius: 6px;
  --radius-lg: 10px;
}

html, body {
  min-height: 100vh;
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 15% 10%, rgba(168, 85, 247, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 85% 90%, rgba(0, 240, 255, 0.05) 0%, transparent 50%);
  z-index: -1;
}

/* ═══════ LOGIN SCREEN ═══════ */
.login-screen {
  position: fixed;
  inset: 0;
  background: var(--bg-deep);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  transition: opacity 0.4s, visibility 0.4s;
}

.login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

.login-box {
  background: var(--bg-card);
  border: 1px solid rgba(0, 240, 255, 0.15);
  border-radius: var(--radius-lg);
  padding: 40px 36px;
  width: 360px;
  max-width: 90%;
  text-align: center;
  backdrop-filter: blur(20px);
}

.login-box h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 4px;
  color: var(--neon-cyan);
  margin-bottom: 6px;
}

.login-box p {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

.login-box input {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-input);
  border: 1px solid rgba(0, 240, 255, 0.12);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  outline: none;
  transition: border-color 0.3s;
  margin-bottom: 16px;
  text-align: center;
  letter-spacing: 3px;
}

.login-box input:focus { border-color: var(--neon-cyan); }

.login-box input::placeholder {
  letter-spacing: 1px;
  color: var(--text-secondary);
  opacity: 0.5;
}

.login-error {
  font-size: 13px;
  color: var(--neon-red);
  margin-bottom: 12px;
  display: none;
}

.login-box button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, rgba(0, 240, 255, 0.15), rgba(168, 85, 247, 0.15));
  border: 1px solid rgba(0, 240, 255, 0.3);
  border-radius: var(--radius);
  color: var(--neon-cyan);
  font-family: 'Orbitron', sans-serif;
  font-size: 12px;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.login-box button:hover {
  background: linear-gradient(135deg, rgba(0, 240, 255, 0.25), rgba(168, 85, 247, 0.25));
  box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
}

/* ═══════ ADMIN DASHBOARD ═══════ */
.admin-dashboard {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px 16px 60px;
  display: none;
}

.admin-dashboard.visible { display: block; }

/* Header */
.admin-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
  margin-bottom: 20px;
  border-bottom: 1px solid rgba(0, 240, 255, 0.08);
}

.admin-header h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--neon-cyan);
}

.admin-header .status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--neon-green);
  font-family: 'Space Mono', monospace;
}

.admin-header .status .dot {
  width: 8px;
  height: 8px;
  background: var(--neon-green);
  border-radius: 50%;
  animation: statusPulse 2s ease-in-out infinite;
}

@keyframes statusPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid rgba(0, 240, 255, 0.08);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 16px;
  backdrop-filter: blur(10px);
}

.card-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--neon-purple);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-title svg {
  width: 16px;
  height: 16px;
  fill: currentColor;
}

/* Form elements */
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 12px;
}

.form-row.single {
  grid-template-columns: 1fr;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.form-group label {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text-secondary);
  font-family: 'Rajdhani', sans-serif;
}

.form-group input {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg-input);
  border: 1px solid rgba(0, 240, 255, 0.08);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
  font-size: 15px;
  font-weight: 500;
  outline: none;
  transition: border-color 0.2s;
}

.form-group input:focus { border-color: var(--neon-cyan); }

/* Score controls */
.score-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.score-team {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 16px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(0, 240, 255, 0.06);
}

.score-team.team-a { border-color: rgba(0, 240, 255, 0.12); }
.score-team.team-b { border-color: rgba(168, 85, 247, 0.12); }

.score-team-label {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  font-weight: 600;
}

.score-team.team-a .score-team-label { color: var(--neon-cyan); }
.score-team.team-b .score-team-label { color: var(--neon-purple); }

.score-display {
  font-family: 'Orbitron', sans-serif;
  font-size: 42px;
  font-weight: 900;
  color: var(--text-bright);
  line-height: 1;
  min-width: 60px;
  text-align: center;
}

.score-btns {
  display: flex;
  gap: 8px;
}

.btn-score {
  width: 48px;
  height: 48px;
  border-radius: var(--radius);
  border: 1px solid rgba(0, 240, 255, 0.15);
  background: rgba(0, 240, 255, 0.06);
  color: var(--neon-cyan);
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-score:hover {
  background: rgba(0, 240, 255, 0.15);
  box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
}

.btn-score.minus {
  border-color: rgba(239, 68, 68, 0.2);
  background: rgba(239, 68, 68, 0.06);
  color: var(--neon-red);
}

.btn-score.minus:hover {
  background: rgba(239, 68, 68, 0.15);
  box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
}

/* Sets row */
.sets-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 12px;
}

.sets-team {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.sets-label {
  font-size: 12px;
  color: var(--text-secondary);
  letter-spacing: 1px;
  text-transform: uppercase;
}

.sets-display {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--neon-green);
  min-width: 30px;
  text-align: center;
}

.btn-set {
  width: 32px;
  height: 32px;
  border-radius: var(--radius);
  border: 1px solid rgba(34, 211, 238, 0.15);
  background: rgba(34, 211, 238, 0.06);
  color: var(--neon-green);
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-set:hover {
  background: rgba(34, 211, 238, 0.15);
}

.btn-set.minus {
  color: var(--neon-red);
  border-color: rgba(239, 68, 68, 0.15);
  background: rgba(239, 68, 68, 0.06);
}

/* Serve toggle */
.serve-toggle-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-top: 8px;
}

.serve-btn {
  padding: 10px 24px;
  border-radius: var(--radius);
  border: 1px solid rgba(251, 191, 36, 0.15);
  background: rgba(251, 191, 36, 0.04);
  color: var(--text-secondary);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.serve-btn.active {
  border-color: var(--neon-yellow);
  background: rgba(251, 191, 36, 0.12);
  color: var(--neon-yellow);
  box-shadow: 0 0 15px rgba(251, 191, 36, 0.15);
}

.serve-btn:hover {
  background: rgba(251, 191, 36, 0.1);
}

.serve-icon {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: transparent;
  margin-right: 6px;
  vertical-align: middle;
  transition: background 0.3s;
}

.serve-btn.active .serve-icon {
  background: var(--neon-yellow);
  box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
}

.serve-switch-btn {
  padding: 10px 18px;
  border-radius: var(--radius);
  border: 1px solid rgba(244, 114, 182, 0.2);
  background: rgba(244, 114, 182, 0.06);
  color: var(--neon-pink);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.serve-switch-btn:hover {
  background: rgba(244, 114, 182, 0.15);
  box-shadow: 0 0 15px rgba(244, 114, 182, 0.15);
}

/* End Set button */
.btn-end-set {
  width: 100%;
  padding: 14px 20px;
  border-radius: var(--radius);
  border: 1px solid rgba(251, 191, 36, 0.3);
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(251, 191, 36, 0.15));
  color: var(--neon-yellow);
  font-family: 'Orbitron', sans-serif;
  font-size: 12px;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 16px;
}

.btn-end-set:hover {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.25));
  box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
}

/* Set history display in admin */
.set-history-display {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid rgba(0, 240, 255, 0.06);
}

.set-history-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-secondary);
  opacity: 0.6;
  margin-bottom: 10px;
}

.set-history-table {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.set-history-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--radius);
  border: 1px solid rgba(0, 240, 255, 0.04);
}

.set-history-row .set-num {
  font-family: 'Orbitron', sans-serif;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--text-secondary);
  opacity: 0.5;
  min-width: 30px;
}

.set-history-row .set-scores {
  flex: 1;
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: 2px;
}

.set-history-row .set-scores .winner { color: var(--neon-green); }
.set-history-row .set-scores .loser { color: var(--text-secondary); opacity: 0.6; }
.set-history-row .set-scores .tb-info {
  font-size: 10px;
  color: var(--text-secondary);
  opacity: 0.5;
  vertical-align: super;
}

.set-history-row .btn-remove-set {
  width: 24px;
  height: 24px;
  border-radius: 4px;
  border: 1px solid rgba(239, 68, 68, 0.15);
  background: rgba(239, 68, 68, 0.06);
  color: var(--neon-red);
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  opacity: 0.5;
}

.set-history-row .btn-remove-set:hover {
  opacity: 1;
  background: rgba(239, 68, 68, 0.15);
}

.no-sets-msg {
  font-size: 12px;
  color: var(--text-secondary);
  opacity: 0.4;
  text-align: center;
  padding: 8px;
  font-style: italic;
}

/* Tiebreak score input for end set */
.end-set-tb-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-top: 10px;
}

.end-set-tb-row label {
  font-size: 11px;
  color: var(--text-secondary);
  letter-spacing: 1px;
  text-transform: uppercase;
}

.end-set-tb-row input {
  width: 60px;
  padding: 6px 8px;
  background: var(--bg-input);
  border: 1px solid rgba(0, 240, 255, 0.08);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  font-weight: 700;
  text-align: center;
  outline: none;
}

.end-set-tb-row input:focus { border-color: var(--neon-cyan); }

/* Reset button */
.reset-section {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
}

.btn-reset {
  padding: 10px 28px;
  border-radius: var(--radius);
  border: 1px solid rgba(239, 68, 68, 0.25);
  background: rgba(239, 68, 68, 0.06);
  color: var(--neon-red);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-reset:hover {
  background: rgba(239, 68, 68, 0.15);
  box-shadow: 0 0 15px rgba(239, 68, 68, 0.15);
}

/* Toast notification */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: rgba(15, 20, 35, 0.95);
  border: 1px solid rgba(0, 240, 255, 0.2);
  border-radius: var(--radius);
  padding: 12px 20px;
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  color: var(--neon-green);
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 1000;
  backdrop-filter: blur(10px);
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

/* Responsive */
@media (max-width: 600px) {
  .admin-dashboard { padding: 12px 10px 40px; }
  .form-row { grid-template-columns: 1fr; }
  .score-controls { grid-template-columns: 1fr; gap: 12px; }
  .sets-controls { grid-template-columns: 1fr; gap: 12px; }
  .serve-toggle-container { flex-direction: column; gap: 10px; }
  .score-display { font-size: 32px; }
}

/* Standings editor */
.standings-editor-panel { display: flex; flex-direction: column; gap: 0; }
.st-header { display: grid; grid-template-columns: 26px 1fr repeat(8, 44px); gap: 4px; padding: 6px 4px 10px; border-bottom: 1px solid rgba(0,240,255,0.1); }
.st-header span { font-family: 'Orbitron', sans-serif; font-size: 7px; letter-spacing: 1px; text-transform: uppercase; color: var(--text-secondary); opacity: 0.6; text-align: center; }
.st-header span:nth-child(2) { text-align: left; }
.st-header span.diff-col { color: var(--neon-cyan); opacity: 0.5; }
.st-team-row { display: grid; grid-template-columns: 26px 1fr repeat(8, 44px); gap: 4px; align-items: center; padding: 4px; border-bottom: 1px solid rgba(0,240,255,0.03); }
.st-team-row:hover { background: rgba(0,240,255,0.02); }
.st-team-row .st-num { font-family: 'Orbitron', sans-serif; font-size: 10px; color: var(--text-secondary); opacity: 0.5; text-align: center; }
.st-team-row input { width: 100%; padding: 7px 4px; background: var(--bg-input); border: 1px solid rgba(0,240,255,0.08); border-radius: var(--radius); color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 500; outline: none; text-align: center; transition: border-color 0.2s; }
.st-team-row input[data-f="name"] { text-align: left; padding-left: 8px; }
.st-team-row input:focus { border-color: var(--neon-cyan); background: rgba(0,240,255,0.04); }
.st-team-row .st-diff { font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 700; text-align: center; color: var(--neon-cyan); }
.st-team-row .st-diff.neg { color: var(--neon-red); }
.st-team-row input[type="number"] { -moz-appearance: textfield; }
.st-team-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* Schedule editor */
.sched-editor-panel { display: flex; flex-direction: column; gap: 0; }
.sched-fixture-header { display: flex; align-items: center; gap: 12px; padding: 12px 0 8px; border-bottom: 1px solid rgba(0,240,255,0.06); }
.sched-fixture-header .fix-label { font-family: 'Orbitron', sans-serif; font-size: 11px; color: var(--neon-yellow); letter-spacing: 2px; min-width: 90px; }
.sched-fixture-header input { flex: 1; padding: 8px 12px; background: var(--bg-input); border: 1px solid rgba(0,240,255,0.08); border-radius: var(--radius); color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 14px; outline: none; }
.sched-fixture-header input:focus { border-color: var(--neon-cyan); }
.sched-match-datetime {
  display: flex;
  gap: 8px;
  padding: 10px 0 2px;
  margin-top: 6px;
  border-top: 1px solid rgba(0,240,255,0.06);
}
.sched-match-datetime input {
  padding: 6px 8px;
  background: var(--bg-input);
  border: 1px solid rgba(251,191,36,0.12);
  border-radius: var(--radius);
  color: var(--neon-yellow);
  font-family: 'Rajdhani', sans-serif;
  font-size: 13px;
  outline: none;
  transition: border-color 0.2s;
}
.sched-match-datetime input:focus { border-color: var(--neon-yellow); }
.sched-match-datetime input[type="date"] { flex: 1; }
.sched-match-datetime input[type="time"] { width: 100px; }
.sched-match-row { display: grid; grid-template-columns: 1fr 60px 12px 60px 1fr; gap: 6px; align-items: center; padding: 6px 0 10px; }
.sched-match-row input { width: 100%; padding: 7px 6px; background: var(--bg-input); border: 1px solid rgba(0,240,255,0.06); border-radius: var(--radius); color: var(--text-primary); font-family: 'Rajdhani', sans-serif; font-size: 13px; outline: none; text-align: center; }
.sched-match-row input.team-input { text-align: left; padding-left: 8px; }
.sched-match-row input.score-input { font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700; color: var(--neon-cyan); }
.sched-match-row input:focus { border-color: var(--neon-cyan); }
.sched-match-row .vs-label { text-align: center; font-size: 10px; color: var(--text-secondary); opacity: 0.3; }
.sched-nav { display: flex; justify-content: center; gap: 4px; margin-bottom: 12px; flex-wrap: wrap; }
.sched-nav-btn { padding: 6px 12px; font-family: 'Orbitron', sans-serif; font-size: 9px; letter-spacing: 1px; color: var(--text-secondary); background: rgba(0,0,0,0.2); border: 1px solid rgba(0,240,255,0.06); border-radius: var(--radius); cursor: pointer; transition: all 0.2s; }
.sched-nav-btn:hover { color: var(--text-bright); }
.sched-nav-btn.active { color: var(--neon-yellow); border-color: rgba(251,191,36,0.3); background: rgba(251,191,36,0.06); }

@media (max-width: 600px) {
  .st-team-row { grid-template-columns: 20px 1fr repeat(8, 34px); gap: 2px; }
  .st-header { grid-template-columns: 20px 1fr repeat(8, 34px); gap: 2px; }
  .st-team-row input { font-size: 11px; padding: 5px 2px; }
  .st-header span { font-size: 5px; }
  .sched-match-row { grid-template-columns: 1fr 45px 10px 45px 1fr; gap: 3px; }
  .sched-match-row input { font-size: 11px; padding: 5px 3px; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <h1>ADMIN</h1>
    <p>Padel Live Broadcast Control</p>
    <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="off">
    <div class="login-error" id="loginError">Incorrect password</div>
    <button onclick="attemptLogin()">Authenticate</button>
  </div>
</div>

<!-- ADMIN DASHBOARD -->
<div class="admin-dashboard" id="adminDashboard">

  <div class="admin-header">
    <h1>⚡ BROADCAST CONTROL</h1>
    <div class="status">
      <span class="dot"></span>
      Firebase Connected
    </div>
  </div>

  <!-- TEAM NAMES -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
      Teams & Players
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Team A Name</label>
        <input type="text" id="teamAInput" placeholder="e.g. THUNDER" maxlength="20">
      </div>
      <div class="form-group">
        <label>Team B Name</label>
        <input type="text" id="teamBInput" placeholder="e.g. STORM" maxlength="20">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Players A</label>
        <input type="text" id="playersAInput" placeholder="e.g. García / López">
      </div>
      <div class="form-group">
        <label>Players B</label>
        <input type="text" id="playersBInput" placeholder="e.g. Martínez / Ruiz">
      </div>
    </div>
  </div>

  <!-- SCORE & SETS -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
      Score Control
    </div>
    <div class="score-controls">
      <div class="score-team team-a">
        <div class="score-team-label" id="scoreTeamALabel">TEAM A</div>
        <div class="score-display" id="scoreADisplay">0</div>
        <div class="score-btns">
          <button class="btn-score minus" onclick="adjustScore('A', -1)">−</button>
          <button class="btn-score" onclick="adjustScore('A', 1)">+</button>
        </div>
      </div>
      <div class="score-team team-b">
        <div class="score-team-label" id="scoreTeamBLabel">TEAM B</div>
        <div class="score-display" id="scoreBDisplay">0</div>
        <div class="score-btns">
          <button class="btn-score minus" onclick="adjustScore('B', -1)">−</button>
          <button class="btn-score" onclick="adjustScore('B', 1)">+</button>
        </div>
      </div>
    </div>

    <div class="sets-controls">
      <div class="sets-team">
        <span class="sets-label">Sets A</span>
        <button class="btn-set minus" onclick="adjustSets('A', -1)">−</button>
        <span class="sets-display" id="setsADisplay">0</span>
        <button class="btn-set" onclick="adjustSets('A', 1)">+</button>
      </div>
      <div class="sets-team">
        <span class="sets-label">Sets B</span>
        <button class="btn-set minus" onclick="adjustSets('B', -1)">−</button>
        <span class="sets-display" id="setsBDisplay">0</span>
        <button class="btn-set" onclick="adjustSets('B', 1)">+</button>
      </div>
    </div>

    <!-- END SET BUTTON -->
    <button class="btn-end-set" onclick="endCurrentSet()">⚡ END SET — Save Score & Reset Games</button>

    <!-- Tiebreak score for set (optional) -->
    <div class="end-set-tb-row" id="endSetTbRow" style="display:none;">
      <label>TB Score:</label>
      <input type="number" id="tbScoreLoser" placeholder="0" min="0" max="99">
      <span style="color:var(--text-secondary);font-size:11px;">(loser's tiebreak pts)</span>
    </div>

    <!-- SET HISTORY -->
    <div class="set-history-display">
      <div class="set-history-title">Completed Sets</div>
      <div class="set-history-table" id="setHistoryTable">
        <div class="no-sets-msg">No sets played yet</div>
      </div>
    </div>
  </div>
  
<!-- POINTS (Tennis-style) -->
<div class="card">
  <div class="card-title">
    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
    Points (Game Points)
  </div>
  <div style="display:flex;justify-content:center;margin-bottom:12px;">
    <button class="serve-btn" id="tiebreakToggle" onclick="toggleTiebreak()" style="font-size:10px;letter-spacing:1px;">TIEBREAK OFF</button>
  </div>
  <div class="score-controls">
    <div class="score-team team-a">
      <div class="score-team-label" id="pointsTeamALabel">PTS A</div>
      <div class="score-display" id="pointsADisplay">0</div>
      <div class="score-btns">
        <button class="btn-score minus" onclick="adjustPoints('A', -1)">−</button>
        <button class="btn-score" onclick="adjustPoints('A', 1)">+</button>
      </div>
    </div>
    <div class="score-team team-b">
      <div class="score-team-label" id="pointsTeamBLabel">PTS B</div>
      <div class="score-display" id="pointsBDisplay">0</div>
      <div class="score-btns">
        <button class="btn-score minus" onclick="adjustPoints('B', -1)">−</button>
        <button class="btn-score" onclick="adjustPoints('B', 1)">+</button>
      </div>
    </div>
  </div>
  <div style="display:flex;justify-content:center;margin-top:12px;">
    <button class="btn-set" onclick="resetPoints()" style="width:auto;padding:6px 16px;font-size:10px;">Reset Points</button>
  </div>
</div>

  <!-- SERVE -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      Serve Indicator
    </div>
    <div class="serve-toggle-container">
      <button class="serve-btn active" id="serveA" onclick="setServe('A')">
        <span class="serve-icon"></span>Team A Serves
      </button>
      <button class="serve-switch-btn" onclick="switchServe()">⇄ Switch</button>
      <button class="serve-btn" id="serveB" onclick="setServe('B')">
        <span class="serve-icon"></span>Team B Serves
      </button>
    </div>
  </div>

  <!-- STREAM URL & BROADCAST DELAY -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-6l-7 4V7z"/></svg>
      Stream URL
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>YouTube URL or Embed URL</label>
        <input type="text" id="streamURLInput" placeholder="https://youtube.com/watch?v=... or embed URL">
      </div>
    </div>
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(0,240,255,0.06);">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
        <label style="font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon-yellow);text-transform:uppercase;">Score Broadcast Delay</label>
        <span id="delayValueLabel" style="font-family:'Orbitron',sans-serif;font-size:18px;font-weight:700;color:var(--neon-yellow);min-width:50px;text-align:right;">15s</span>
      </div>
      <input type="range" id="delaySlider" min="0" max="60" step="1" value="15" oninput="onDelayChange(this.value)" style="width:100%;accent-color:var(--neon-yellow);cursor:pointer;">
      <div style="display:flex;justify-content:space-between;margin-top:4px;">
        <span style="font-size:10px;color:var(--text-secondary);opacity:0.4;">0s (instant)</span>
        <span style="font-size:10px;color:var(--text-secondary);opacity:0.4;">60s</span>
      </div>
    </div>
  </div>

  <!-- SPONSORS -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
      Sponsor Images
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 1 — Image URL</label>
        <input type="text" id="sponsor1Input" placeholder="https://example.com/logo1.png">
      </div>
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 2 — Image URL</label>
        <input type="text" id="sponsor2Input" placeholder="https://example.com/logo2.png">
      </div>
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 3 — Image URL</label>
        <input type="text" id="sponsor3Input" placeholder="https://example.com/logo3.png">
      </div>
    </div>
  </div>


  <!-- STANDINGS MANAGEMENT -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
      League Standings
    </div>
    <div style="display:flex;justify-content:center;gap:4px;margin-bottom:16px;">
      <button class="serve-btn active" id="stGroupTab0" onclick="showAdminGroup(0)" type="button">Group A</button>
      <button class="serve-btn" id="stGroupTab1" onclick="showAdminGroup(1)" type="button">Group B</button>
      <button class="serve-btn" id="stGroupTab2" onclick="showAdminGroup(2)" type="button">Group C</button>
    </div>
    <div id="standingsEditor0" class="standings-editor-panel"></div>
    <div id="standingsEditor1" class="standings-editor-panel" style="display:none;"></div>
    <div id="standingsEditor2" class="standings-editor-panel" style="display:none;"></div>
    <div style="display:flex;justify-content:center;margin-top:16px;">
      <button class="btn-end-set" onclick="saveStandings()" type="button" style="max-width:300px;">&#9889; Save Standings</button>
    </div>
  </div>

  <!-- SCHEDULE MANAGEMENT -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
      Schedule &amp; Fixtures
    </div>
    <div style="display:flex;justify-content:center;gap:4px;margin-bottom:12px;">
      <button class="serve-btn active" id="scGroupTab0" onclick="showSchedAdminGroup(0)" type="button">Group A</button>
      <button class="serve-btn" id="scGroupTab1" onclick="showSchedAdminGroup(1)" type="button">Group B</button>
      <button class="serve-btn" id="scGroupTab2" onclick="showSchedAdminGroup(2)" type="button">Group C</button>
    </div>
    <div class="sched-nav" id="schedFixtureNav"></div>
    <div id="schedEditor0" class="sched-editor-panel"></div>
    <div id="schedEditor1" class="sched-editor-panel" style="display:none;"></div>
    <div id="schedEditor2" class="sched-editor-panel" style="display:none;"></div>
    <div style="display:flex;justify-content:center;margin-top:16px;">
      <button class="btn-end-set" onclick="saveSchedule()" type="button" style="max-width:300px;">&#9889; Save Schedule</button>
    </div>
  </div>

  <!-- RESET -->
  <div class="reset-section">
    <button class="btn-reset" onclick="resetScores()">Reset Scores</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
// ══════════════════════════════════
// AUTH
// ══════════════════════════════════
let isAuthenticated = false;

// Check saved auth
if (sessionStorage.getItem('padel_admin_auth') === 'true') {
  isAuthenticated = true;
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('adminDashboard').classList.add('visible');
}

function attemptLogin() {
  const pw = document.getElementById('passwordInput').value;
  if (pw === ADMIN_PASSWORD) {
    isAuthenticated = true;
    sessionStorage.setItem('padel_admin_auth', 'true');
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('adminDashboard').classList.add('visible');
    initAdmin();
  } else {
    document.getElementById('loginError').style.display = 'block';
    document.getElementById('passwordInput').value = '';
    document.getElementById('passwordInput').focus();
  }
}

document.getElementById('passwordInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') attemptLogin();
});

// ══════════════════════════════════
// FIREBASE INIT
// ══════════════════════════════════
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const matchRef = db.ref('match');

// Local state
let matchData = {
  teamA: '', teamB: '',
  playersA: '', playersB: '',
  scoreA: 0, scoreB: 0,
  setsA: 0, setsB: 0,
  pointsA: 0, pointsB: 0,
  isTiebreak: false,
  serving: 'A',
  streamURL: '',
  sponsors: { s1: '', s2: '', s3: '' },
  setHistory: []
};

// ══════════════════════════════════
// TOAST
// ══════════════════════════════════
let toastTimeout;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = '✓ ' + msg;
  t.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => t.classList.remove('show'), 2000);
}

// ══════════════════════════════════
// SYNC FROM FIREBASE → ADMIN UI
// ══════════════════════════════════
function syncUI(data) {
  matchData = { ...matchData, ...data };
  if (data.setHistory) {
    matchData.setHistory = Object.values(data.setHistory);
  } else {
    matchData.setHistory = [];
  }

  document.getElementById('teamAInput').value = data.teamA || '';
  document.getElementById('teamBInput').value = data.teamB || '';
  document.getElementById('playersAInput').value = data.playersA || '';
  document.getElementById('playersBInput').value = data.playersB || '';
  document.getElementById('streamURLInput').value = data.streamURL || '';

  // Sync delay slider
  var delayVal = data.scoreDelay !== undefined ? data.scoreDelay : 15;
  document.getElementById('delaySlider').value = delayVal;
  document.getElementById('delayValueLabel').textContent = delayVal + 's';

  const sponsors = data.sponsors || {};
  document.getElementById('sponsor1Input').value = sponsors.s1 || '';
  document.getElementById('sponsor2Input').value = sponsors.s2 || '';
  document.getElementById('sponsor3Input').value = sponsors.s3 || '';

  updateScoreUI();
  updateServeUI();
  renderSetHistory();
}

function updateScoreUI() {
  document.getElementById('scoreADisplay').textContent = matchData.scoreA;
  document.getElementById('scoreBDisplay').textContent = matchData.scoreB;
  document.getElementById('setsADisplay').textContent = matchData.setsA;
  document.getElementById('setsBDisplay').textContent = matchData.setsB;
  document.getElementById('scoreTeamALabel').textContent = matchData.teamA || 'TEAM A';
  document.getElementById('scoreTeamBLabel').textContent = matchData.teamB || 'TEAM B';
  document.getElementById('pointsTeamALabel').textContent = matchData.teamA || 'PTS A';
  document.getElementById('pointsTeamBLabel').textContent = matchData.teamB || 'PTS B';
  document.getElementById('pointsADisplay').textContent = getPointsDisplay(matchData.pointsA || 0, matchData.isTiebreak);
  document.getElementById('pointsBDisplay').textContent = getPointsDisplay(matchData.pointsB || 0, matchData.isTiebreak);
  var tbBtn = document.getElementById('tiebreakToggle');
  if (tbBtn) tbBtn.textContent = matchData.isTiebreak ? 'TIEBREAK ON' : 'TIEBREAK OFF';
}

function updateServeUI() {
  const serveA = document.getElementById('serveA');
  const serveB = document.getElementById('serveB');
  serveA.classList.toggle('active', matchData.serving === 'A');
  serveB.classList.toggle('active', matchData.serving === 'B');
}

// ══════════════════════════════════
// WRITE TO FIREBASE
// ══════════════════════════════════
// Tennis-style points sequence
const POINTS_SEQUENCE = [0, 15, 30, 40];

function getPointsDisplay(pointsVal, isTiebreak) {
  if (isTiebreak) return pointsVal; // tiebreak: 0,1,2,3...
  if (pointsVal >= 0 && pointsVal < POINTS_SEQUENCE.length) {
    return POINTS_SEQUENCE[pointsVal];
  }
  return 'A'; // advantage
}

function adjustPoints(team, delta) {
  const key = team === 'A' ? 'pointsA' : 'pointsB';
  let newVal;
  if (matchData.isTiebreak) {
    // Tiebreak: simple increment/decrement (0, 1, 2, 3...)
    newVal = Math.max(0, (matchData[key] || 0) + delta);
  } else {
    // Tennis points: 0=0, 1=15, 2=30, 3=40, 4=A
    newVal = Math.max(0, Math.min(4, (matchData[key] || 0) + delta));
  }
  pushData({ [key]: newVal }, `Points ${team}: ${getPointsDisplay(newVal, matchData.isTiebreak)}`);
}

function toggleTiebreak() {
  const newVal = !matchData.isTiebreak;
  pushData({ isTiebreak: newVal, pointsA: 0, pointsB: 0 }, newVal ? 'Tiebreak ON' : 'Tiebreak OFF');
}

function resetPoints() {
  pushData({ pointsA: 0, pointsB: 0 }, 'Points reset');
}
  
function pushData(updates, msg) {
  matchRef.update(updates).then(() => {
    Object.assign(matchData, updates);
    updateScoreUI();
    updateServeUI();
    if (msg) showToast(msg);
  });
}

// Score
function adjustScore(team, delta) {
  const key = team === 'A' ? 'scoreA' : 'scoreB';
  const newVal = Math.max(0, (matchData[key] || 0) + delta);
  pushData({ [key]: newVal }, `Score ${team}: ${newVal}`);
}

// Sets
function adjustSets(team, delta) {
  const key = team === 'A' ? 'setsA' : 'setsB';
  const newVal = Math.max(0, (matchData[key] || 0) + delta);
  pushData({ [key]: newVal }, `Sets ${team}: ${newVal}`);
}

// Serve
function setServe(team) {
  pushData({ serving: team }, `Serve → Team ${team}`);
}

function switchServe() {
  const newServe = matchData.serving === 'A' ? 'B' : 'A';
  pushData({ serving: newServe }, `Serve → Team ${newServe}`);
}

// End current set: save games to set history, increment winner's sets, reset games & points
function endCurrentSet() {
  const gamesA = matchData.scoreA || 0;
  const gamesB = matchData.scoreB || 0;

  if (gamesA === 0 && gamesB === 0) {
    showToast('No games to save');
    return;
  }

  if (!confirm(`End set with score ${gamesA}-${gamesB}?`)) return;

  const setEntry = { gamesA, gamesB };

  // Check if this was a tiebreak set (optional: admin can enter loser's TB score)
  const tbInput = document.getElementById('tbScoreLoser');
  const tbVal = parseInt(tbInput.value);
  if (!isNaN(tbVal) && tbVal >= 0) {
    // Assign tiebreak score to the loser
    if (gamesA > gamesB) {
      setEntry.tiebreakB = tbVal;
    } else if (gamesB > gamesA) {
      setEntry.tiebreakA = tbVal;
    }
  }
  tbInput.value = '';

  // Add to set history
  const history = matchData.setHistory || [];
  history.push(setEntry);

  // Determine who won the set and increment their sets count
  let newSetsA = matchData.setsA || 0;
  let newSetsB = matchData.setsB || 0;
  if (gamesA > gamesB) {
    newSetsA++;
  } else if (gamesB > gamesA) {
    newSetsB++;
  }

  // Push: save history, update sets, reset games and points
  const updates = {
    setHistory: history,
    setsA: newSetsA,
    setsB: newSetsB,
    scoreA: 0,
    scoreB: 0,
    pointsA: 0,
    pointsB: 0,
    isTiebreak: false
  };

  pushData(updates, `Set ${history.length} saved: ${gamesA}-${gamesB}`);
  renderSetHistory();
}

// Render set history in admin panel
function renderSetHistory() {
  const container = document.getElementById('setHistoryTable');
  const history = matchData.setHistory || [];

  if (history.length === 0) {
    container.innerHTML = '<div class="no-sets-msg">No sets played yet</div>';
    document.getElementById('endSetTbRow').style.display = 'none';
    return;
  }

  // Show tiebreak input row
  document.getElementById('endSetTbRow').style.display = 'flex';

  let html = '';
  for (let i = 0; i < history.length; i++) {
    const s = history[i];
    const gA = s.gamesA ?? 0;
    const gB = s.gamesB ?? 0;
    const aWon = gA > gB;
    const bWon = gB > gA;
    const teamA = matchData.teamA || 'A';
    const teamB = matchData.teamB || 'B';

    let scoreStr = '';
    scoreStr += `<span class="${aWon ? 'winner' : 'loser'}">${gA}</span>`;
    if (s.tiebreakA !== undefined && s.tiebreakA !== null) {
      scoreStr += `<span class="tb-info">${s.tiebreakA}</span>`;
    }
    scoreStr += ` — `;
    scoreStr += `<span class="${bWon ? 'winner' : 'loser'}">${gB}</span>`;
    if (s.tiebreakB !== undefined && s.tiebreakB !== null) {
      scoreStr += `<span class="tb-info">${s.tiebreakB}</span>`;
    }

    html += `<div class="set-history-row">
      <span class="set-num">S${i + 1}</span>
      <span class="set-scores">${scoreStr}</span>
      <button class="btn-remove-set" onclick="removeSet(${i})" title="Remove set">✕</button>
    </div>`;
  }

  container.innerHTML = html;
}

// Remove a set from history
function removeSet(index) {
  if (!confirm(`Remove Set ${index + 1} from history?`)) return;

  const history = matchData.setHistory || [];
  const removed = history.splice(index, 1)[0];

  // Adjust sets count: if the removed set had a winner, decrement their sets
  let newSetsA = matchData.setsA || 0;
  let newSetsB = matchData.setsB || 0;
  if (removed) {
    if ((removed.gamesA ?? 0) > (removed.gamesB ?? 0)) {
      newSetsA = Math.max(0, newSetsA - 1);
    } else if ((removed.gamesB ?? 0) > (removed.gamesA ?? 0)) {
      newSetsB = Math.max(0, newSetsB - 1);
    }
  }

  const updates = {
    setHistory: history.length > 0 ? history : null,
    setsA: newSetsA,
    setsB: newSetsB
  };

  // Firebase doesn't store null well, use remove for empty
  if (history.length === 0) {
    matchRef.child('setHistory').remove();
    delete updates.setHistory;
  }

  pushData(updates, `Set ${index + 1} removed`);
  renderSetHistory();
}

// Resets
function resetScores() {
  if (!confirm('Reset scores, sets, and set history to 0?')) return;
  matchRef.child('setHistory').remove();
  pushData({ scoreA: 0, scoreB: 0, setsA: 0, setsB: 0, pointsA: 0, pointsB: 0, isTiebreak: false }, 'Scores reset');
  matchData.setHistory = [];
  renderSetHistory();
}



// ══════════════════════════════════
// TEXT INPUT DEBOUNCED SYNC
// ══════════════════════════════════
function debounce(fn, ms) {
  let t;
  return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
}

const syncText = debounce((key, val) => {
  if (key.startsWith('sponsors.')) {
    pushData({ [key]: val });
  } else {
    pushData({ [key]: val });
  }
}, 400);

function bindTextInput(elId, key) {
  document.getElementById(elId).addEventListener('input', (e) => {
    syncText(key, e.target.value);
  });
}

// ══════════════════════════════════
// BROADCAST DELAY CONTROL
// ══════════════════════════════════
var delayDebounce = null;
function onDelayChange(val) {
  val = parseInt(val) || 0;
  document.getElementById('delayValueLabel').textContent = val + 's';
  clearTimeout(delayDebounce);
  delayDebounce = setTimeout(function() {
    matchRef.update({ scoreDelay: val }).then(function() {
      showToast('Delay: ' + val + 's');
    });
  }, 500);
}

// ══════════════════════════════════
// INIT
// ══════════════════════════════════
function initAdmin() {
  // Listen for data
  matchRef.on('value', (snap) => {
    const data = snap.val();
    if (data) syncUI(data);
  });

  // Bind text inputs
  bindTextInput('teamAInput', 'teamA');
  bindTextInput('teamBInput', 'teamB');
  bindTextInput('playersAInput', 'playersA');
  bindTextInput('playersBInput', 'playersB');
  bindTextInput('streamURLInput', 'streamURL');
  bindTextInput('sponsor1Input', 'sponsors/s1');
  bindTextInput('sponsor2Input', 'sponsors/s2');
  bindTextInput('sponsor3Input', 'sponsors/s3');
}

// Auto-init if already authed
if (isAuthenticated) initAdmin();


// ══════════════════════════════════
// STANDINGS MANAGEMENT
// ══════════════════════════════════
var standingsRef = db.ref('standings');
var standingsData = { group0: {}, group1: {}, group2: {} };
var skipStandingsRebuild = false;

function showAdminGroup(g) {
  for (var i = 0; i < 3; i++) {
    document.getElementById('standingsEditor' + i).style.display = i === g ? 'flex' : 'none';
    document.getElementById('stGroupTab' + i).classList.toggle('active', i === g);
  }
}

function buildStandingsEditor(gi) {
  var c = document.getElementById('standingsEditor' + gi);
  if (!c) return;
  var teams = standingsData['group' + gi] ? Object.values(standingsData['group' + gi]) : [];
  var h = '<div class="st-header"><span>#</span><span>Pair Name</span><span>W</span><span>S+</span><span>S\u2212</span><span class="diff-col">SD</span><span>G+</span><span>G\u2212</span><span class="diff-col">GD</span><span></span></div>';
  for (var i = 0; i < 8; i++) {
    var t = teams[i] || {};
    var nm = (t.name || '').replace(/"/g, '&quot;');
    var sd = (t.setsPlus||0) - (t.setsMinus||0);
    var gd = (t.gamesPlus||0) - (t.gamesMinus||0);
    h += '<div class="st-team-row">';
    h += '<span class="st-num">' + (i+1) + '</span>';
    h += '<input type="text" data-g="'+gi+'" data-i="'+i+'" data-f="name" value="'+nm+'" placeholder="Pair '+(i+1)+'">';
    h += '<input type="number" data-g="'+gi+'" data-i="'+i+'" data-f="wins" value="'+(t.wins||0)+'" min="0">';
    h += '<input type="number" data-g="'+gi+'" data-i="'+i+'" data-f="setsPlus" value="'+(t.setsPlus||0)+'" min="0" oninput="updateDiffs(this)">';
    h += '<input type="number" data-g="'+gi+'" data-i="'+i+'" data-f="setsMinus" value="'+(t.setsMinus||0)+'" min="0" oninput="updateDiffs(this)">';
    h += '<span class="st-diff'+(sd<0?' neg':'')+'" id="sd_'+gi+'_'+i+'">'+(sd>0?'+'+sd:sd)+'</span>';
    h += '<input type="number" data-g="'+gi+'" data-i="'+i+'" data-f="gamesPlus" value="'+(t.gamesPlus||0)+'" min="0" oninput="updateDiffs(this)">';
    h += '<input type="number" data-g="'+gi+'" data-i="'+i+'" data-f="gamesMinus" value="'+(t.gamesMinus||0)+'" min="0" oninput="updateDiffs(this)">';
    h += '<span class="st-diff'+(gd<0?' neg':'')+'" id="gd_'+gi+'_'+i+'">'+(gd>0?'+'+gd:gd)+'</span>';
    h += '<span></span>';
    h += '</div>';
  }
  c.innerHTML = h;
}

function updateDiffs(el) {
  var g = el.getAttribute('data-g'), i = el.getAttribute('data-i');
  var row = el.closest('.st-team-row');
  var sp = parseInt(row.querySelector('[data-f="setsPlus"]').value)||0;
  var sm = parseInt(row.querySelector('[data-f="setsMinus"]').value)||0;
  var gp = parseInt(row.querySelector('[data-f="gamesPlus"]').value)||0;
  var gm = parseInt(row.querySelector('[data-f="gamesMinus"]').value)||0;
  var sd = sp - sm, gd = gp - gm;
  var sdEl = document.getElementById('sd_'+g+'_'+i);
  var gdEl = document.getElementById('gd_'+g+'_'+i);
  sdEl.textContent = (sd>0?'+'+sd:sd); sdEl.className = 'st-diff' + (sd<0?' neg':'');
  gdEl.textContent = (gd>0?'+'+gd:gd); gdEl.className = 'st-diff' + (gd<0?' neg':'');
}

function buildAllEditors() { for (var g=0;g<3;g++) buildStandingsEditor(g); }

function saveStandings() {
  var updates = {};
  for (var g = 0; g < 3; g++) {
    var inputs = document.querySelectorAll('input[data-g="'+g+'"]');
    var tm = {};
    inputs.forEach(function(inp) {
      var i=inp.getAttribute('data-i'), f=inp.getAttribute('data-f');
      if(!tm[i])tm[i]={};
      tm[i][f] = f==='name' ? inp.value : (parseInt(inp.value)||0);
    });
    var gt = {};
    Object.keys(tm).forEach(function(idx){ if(tm[idx].name&&tm[idx].name.trim()) gt['team'+idx]=tm[idx]; });
    updates['group'+g] = gt;
  }
  skipStandingsRebuild = true;
  standingsRef.set(updates).then(function(){ showToast('Standings saved!'); }).catch(function(e){ showToast('Error: '+e.message); skipStandingsRebuild=false; });
}

standingsRef.on('value', function(snap) {
  var d = snap.val() || {};
  standingsData.group0=d.group0||{}; standingsData.group1=d.group1||{}; standingsData.group2=d.group2||{};
  if (skipStandingsRebuild) { skipStandingsRebuild=false; return; }
  buildAllEditors();
});
buildAllEditors();

// ══════════════════════════════════
// SCHEDULE MANAGEMENT
// ══════════════════════════════════
var scheduleRef = db.ref('schedule');
var schedData = { group0:{}, group1:{}, group2:{} };
var adminSchedGroup = 0, adminSchedFixture = 0;
var skipSchedRebuild = false;
var MATCHES_PER_FIXTURE = 4;

function showSchedAdminGroup(g) {
  adminSchedGroup = g; adminSchedFixture = 0;
  for (var i=0;i<3;i++) {
    document.getElementById('schedEditor'+i).style.display = i===g?'flex':'none';
    document.getElementById('scGroupTab'+i).classList.toggle('active', i===g);
  }
  renderSchedFixtureNav(); buildAllSchedEditors();
}

function renderSchedFixtureNav() {
  var h = '';
  for (var f=0;f<7;f++) {
    h += '<button class="sched-nav-btn'+(f===adminSchedFixture?' active':'')+'" onclick="switchAdminFixture('+f+')" type="button">F'+(f+1)+'</button>';
  }
  document.getElementById('schedFixtureNav').innerHTML = h;
}

function switchAdminFixture(f) {
  adminSchedFixture = f;
  renderSchedFixtureNav();
  buildSchedEditor(adminSchedGroup);
}

function buildSchedEditor(gi) {
  var c = document.getElementById('schedEditor'+gi);
  if (!c) return;
  var gKey = 'group'+gi, fKey = 'fixture'+adminSchedFixture;
  var fData = (schedData[gKey]||{})[fKey] || {};
  var matches = fData.matches ? Object.values(fData.matches) : [];
  var h = '<div class="sched-fixture-header">';
  h += '<span class="fix-label">FIXTURE '+(adminSchedFixture+1)+'</span>';
  h += '</div>';
  for (var i=0; i<MATCHES_PER_FIXTURE; i++) {
    var m = matches[i] || {};
    h += '<div class="sched-match-datetime">';
    h += '<input type="date" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="date" value="'+(m.date||'')+'">';
    h += '<input type="time" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="time" value="'+(m.time||'')+'">';
    h += '</div>';
    h += '<div class="sched-match-row">';
    h += '<input class="team-input" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="teamA" value="'+((m.teamA||'').replace(/"/g,'&quot;'))+'" placeholder="Home team">';
    h += '<input class="score-input" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="scoreA" value="'+(m.scoreA!==undefined?m.scoreA:'')+'" placeholder="\u2013">';
    h += '<span class="vs-label">vs</span>';
    h += '<input class="score-input" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="scoreB" value="'+(m.scoreB!==undefined?m.scoreB:'')+'" placeholder="\u2013">';
    h += '<input class="team-input" data-sg="'+gi+'" data-sf="'+adminSchedFixture+'" data-si="'+i+'" data-smf="teamB" value="'+((m.teamB||'').replace(/"/g,'&quot;'))+'" placeholder="Away team">';
    h += '</div>';
  }
  c.innerHTML = h;
}

function buildAllSchedEditors() { buildSchedEditor(adminSchedGroup); }

function saveSchedule() {
  var updates = {};
  for (var g=0;g<3;g++) {
    var gKey = 'group'+g;
    if (!updates[gKey]) updates[gKey] = JSON.parse(JSON.stringify(schedData[gKey]||{}));
    // Only save the currently visible fixture per group? No - save ALL fixtures.
  }
  // Collect all inputs across all groups/fixtures
  // Since only one group editor is visible at a time, we need to collect from the DOM for current group
  // and keep existing data for other groups. Let's save all data:
  // Actually we need to read from all fixture editors. But we only build one fixture at a time.
  // Solution: save current fixture to schedData, then push everything.
  collectCurrentFixtureToData();
  var allUpdates = {};
  for (var g=0;g<3;g++) { allUpdates['group'+g] = schedData['group'+g] || {}; }
  skipSchedRebuild = true;
  scheduleRef.set(allUpdates).then(function(){ showToast('Schedule saved!'); }).catch(function(e){ showToast('Error: '+e.message); skipSchedRebuild=false; });
}

function collectCurrentFixtureToData() {
  var g = adminSchedGroup, f = adminSchedFixture;
  var gKey='group'+g, fKey='fixture'+f;
  if(!schedData[gKey]) schedData[gKey]={};
  var fObj = { matches: {} };
  var inputs = document.querySelectorAll('[data-sg="'+g+'"][data-sf="'+f+'"]');
  var mMap = {};
  inputs.forEach(function(inp){
    var i=inp.getAttribute('data-si'), mf=inp.getAttribute('data-smf');
    if(!mMap[i]) mMap[i]={};
    mMap[i][mf] = inp.value;
  });
  Object.keys(mMap).forEach(function(idx){
    var m = mMap[idx];
    if ((m.teamA&&m.teamA.trim()) || (m.teamB&&m.teamB.trim())) {
      fObj.matches['match'+idx] = m;
    }
  });
  schedData[gKey][fKey] = fObj;
}

// Auto-save current fixture data when switching fixtures
var _origSwitchFixture = switchAdminFixture;
switchAdminFixture = function(f) {
  collectCurrentFixtureToData();
  adminSchedFixture = f;
  renderSchedFixtureNav();
  buildSchedEditor(adminSchedGroup);
};

scheduleRef.on('value', function(snap) {
  var d = snap.val() || {};
  schedData.group0=d.group0||{}; schedData.group1=d.group1||{}; schedData.group2=d.group2||{};
  if (skipSchedRebuild) { skipSchedRebuild=false; return; }
  buildAllSchedEditors();
});
renderSchedFixtureNav();
buildAllSchedEditors();

</script>
</body>
</html>
